# 改善メモ

## オリジナルのタイム

```log
$ time python opt_brand.py
初期個体群 =
[['4324', '1802', '4661', '4004'], ['2503', '7203', '4661', '4751'], ['5019', '1802', '7201', '2501'], ['6501', '4004', '6503', '1802'], ['1802', '4751', '4503', '7203'], ['4751', '6501', '7201', '6503'], ['4324', '2501', '6501', '1802'], ['5020', '1801', '2503', '5019'], ['8306', '6501', '4385', '5020'], ['4324', '8306', '4385', '4661'], ['5019', '4004', '2503', '2501'], ['4005', '7203', '7201', '4385'], ['7201', '6503', '4502', '1801'], ['4004', '4751', '4005', '1332'], ['1332', '6503', '7203', '8306'], ['4502', '7203', '6501', '2501'], ['8306', '4502', '2503', '4751'], ['4751', '7203', '1802', '1332'], ['1801', '4385', '4502', '5019'], ['4661', '4751', '5019', '1802'], ['4324', '4661', '4503', '6501'], ['5020', '2501', '5019', '4385'], ['4751', '1801', '6501', '7201'], ['4324', '4004', '7201', '2503'], ['4751', '7201', '7203', '1801'], ['8306', '6501', '4502', '2501'], ['2503', '4503', '8306', '5020'], ['8306', '4503', '6501', '6503'], ['7203', '6503', '1332', '5020'], ['4324', '4503', '5019', '4661'], ['2503', '4385', '8306', '7203'], ['2503', '1802', '1332', '6501'], ['1801', '4502', '4385', '1802'], ['2501', '6501', '7203', '5020'], ['1801', '4005', '7203', '5019'], ['5019', '2501', '5020', '6503'], ['4324', '1332', '2503', '1802'], ['4385', '5020', '2503', '4005'], ['1801', '6501', '1802', '2501'], ['4502', '6501', '1801', '7201'], ['7201', '4661', '4502', '1802'], ['1332', '4661', '6503', '2503'], ['7203', '4751', '4661', '5020'], ['6503', '5020', '1802', '2501'], ['5020', '7203', '1801', '1802'], ['4502', '4661', '8306', '5020'], ['4751', '8306', '4502', '5019'], ['4502', '4661', '1802', '7203'], ['4004', '8306', '1332', '4751'], ['4324', '4503', '5019', '5020']]
初期個体群のリスクとリターン =
[(0.00011825257438092392, 0.0009016059972634213), (9.921986174097567e-05, 0.0006187470103004014), (0.00014258776154618726, 0.0016683115436613243), (0.00014741175665161993, 0.0015777398836161242), (0.00011673568719573627, 0.00032401437471304777), (0.00016371841963120541, 0.0010801930202380314), (0.00011164886907032596, 0.001343701495199471), (0.00011820137070303293, 0.0008569046662223587), (0.000162180670476587, 0.001124783047474125), (0.00014366165727954343, 0.0006366823861210482), (0.00010152310767565035, 0.0015088171135150636), (0.00020538129435891794, 0.0005402407941106618), (0.00013527601633818329, 0.0010153895901379435), (0.00011879548687346524, 0.0002623670005012435), (0.00013028786284764146, 0.0015613623875774636), (0.00010116382890025316, 0.0016218201046942424), (8.245728455305384e-05, 0.00017995648076176503), (0.00011759711220691904, 0.0008129980936944369), (0.0001325703033833063, 0.0005926275826543767), (0.00012316159944324756, 0.0007425676389351582), (0.00010156037456613078, 0.0006328647600135365), (0.0001434697261750356, 0.0013902505116425328), (0.00015574686338480054, 0.0007903811426361548), (0.00012272041331735201, 0.00070461092655694), (0.00016992861598495696, 0.0007174171649932626), (9.971454749766185e-05, 0.0015311280822098616), (8.880066533911523e-05, 0.0005425665523803167), (0.00012535180414004852, 0.0011453426462389666), (0.00012124329494132179, 0.0015214091540037317), (9.697722926180255e-05, 0.0004974111681618271), (0.0001394452095596634, 0.000840685434673214), (8.588813568270098e-05, 0.001170382879174534), (0.00013485022732606156, 0.0004996485484906366), (0.00011890477765284849, 0.0018767900914862991), (0.00014782155396651529, 0.0006446148228923592), (0.00013000881787179699, 0.0017987244685761035), (8.5413870717848e-05, 0.0005891536975592584), (0.00011338330814660447, 0.00011601821049523855), (0.00012858803526242068, 0.0016195427905114912), (0.00012924387381630232, 0.0010309655988393219), (0.00011433045939075571, 0.000997440145688322), (8.103502040104708e-05, 0.0012727587830497994), (0.0001194229377268973, 0.0008298806454584201), (0.00011525501924095649, 0.0017057454344123631), (0.00014777961437718382, 0.00110570452327475), (9.338559912562696e-05, 0.0009797730791772066), (0.00011624905850722676, 0.0004592457577690792), (9.671240416151287e-05, 0.0010456417093471428), (0.0001245626769985843, 0.0008563889686211061), (0.00011964527066114768, 0.00040428264789962816)]
1
2
3
4
...
497
498
499
500
最適化された銘柄の組み合わせ =
[['6501', '2501', '4661', '1332'], ['6501', '2501', '1332', '4661'], ['6501', '2501', '1332', '7203'], ['6501', '2501', '1332', '4661'], ['6501', '2501', '1332', '7203'], ['6501', '2501', '1332', '7203'], ['5020', '2501', '4661', '2503'], ['5020', '2501', '4661', '2503'], ['5020', '2501', '4661', '2503'], ['5020', '2501', '4661', '2503'], ['6501', '2501', '4661', '7203'], ['7203', '2501', '4661', '1332'], ['7203', '2501', '4661', '1332'], ['6501', '2501', '1332', '2503'], ['6501', '2501', '1332', '2503'], ['2503', '6501', '1332', '4661'], ['2503', '2501', '4661', '1332'], ['2503', '2501', '4661', '1332'], ['2503', '2501', '4661', '1332'], ['2503', '2501', '4661', '1332'], ['2503', '2501', '4661', '1332'], ['6501', '2501', '1332', '2503'], ['7203', '2501', '4661', '1332'], ['7203', '2501', '4661', '1332'], ['7203', '2501', '4661', '1332'], ['6501', '2501', '1332', '2503'], ['6501', '2501', '1332', '2503'], ['6501', '2501', '4661', '2503'], ['6501', '2501', '4661', '2503'], ['6501', '2501', '4661', '2503'], ['6501', '2501', '4661', '2503'], ['6501', '2501', '4661', '2503'], ['6501', '2501', '4661', '2503'], ['5020', '2501', '1332', '4661'], ['7203', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['5020', '2501', '1332', '4661'], ['7203', '2501', '1332', '4661'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503'], ['7203', '2501', '1332', '2503']]
最適化された銘柄のリターンリスク =
[(8.792551651231565e-05, 0.0015631165834399357), (8.792551651231561e-05, 0.001563116583439936), (0.00010139588530027441, 0.0019403427165030458), (8.792551651231561e-05, 0.001563116583439936), (8.95184933494348e-05, 0.0016281397205323669), (0.00010139588530027441, 0.0019403427165030455), (9.61824557131022e-05, 0.0018673787388601537), (8.792551651231561e-05, 0.001563116583439936), (9.61824557131022e-05, 0.0018673787388601537), (9.067957043184055e-05, 0.0017367334828020408), (7.626981927277223e-05, 0.0014245304868313617), (8.961190288654223e-05, 0.001636080561082828), (0.00010988349156764197, 0.0019778594522989594), (8.961190288654223e-05, 0.001636080561082828), (8.95184933494348e-05, 0.0016281397205323669), (8.95184933494348e-05, 0.0016281397205323669), (9.067957043184055e-05, 0.0017367334828020406), (8.35144864048457e-05, 0.0015255998476440221), (0.00010139588530027441, 0.0019403427165030455), (9.618245571310222e-05, 0.0018673787388601534), (9.322644425564477e-05, 0.001472424560955555), (0.00010096661988977322, 0.0017766867163757725), (8.792551651231561e-05, 0.001563116583439936), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.792551651231561e-05, 0.001563116583439936), (8.614465508782204e-05, 0.0015551757428894748), (8.792551651231561e-05, 0.001563116583439936), (8.35144864048457e-05, 0.0015255998476440221), (7.847091910532248e-05, 0.0012883347917511776), (8.210632374234823e-05, 0.001432471327381823), (7.626981927277223e-05, 0.0014245304868313617), (8.351448640484567e-05, 0.001525599847644022), (8.35144864048457e-05, 0.0015255998476440221), (9.067957043184055e-05, 0.0017367334828020408), (0.00010293316567897123, 0.0017742502185979544), (8.351448640484567e-05, 0.001525599847644022), (8.351448640484567e-05, 0.001525599847644022), (8.210632374234823e-05, 0.001432471327381823), (9.067957043184055e-05, 0.0017367334828020408), (7.626981927277223e-05, 0.0014245304868313617), (9.322644425564477e-05, 0.001472424560955555), (8.210632374234823e-05, 0.001432471327381823), (8.351448640484567e-05, 0.001525599847644022), (8.792551651231565e-05, 0.0015631165834399357), (8.35144864048457e-05, 0.0015255998476440221), (9.067957043184055e-05, 0.0017367334828020408), (7.626981927277223e-05, 0.0014245304868313617), (8.351448640484567e-05, 0.001525599847644022), (8.792551651231561e-05, 0.001563116583439936), (0.00010988349156764197, 0.0019778594522989594), (8.792551651231561e-05, 0.001563116583439936), (0.00010988349156764197, 0.0019778594522989594), (8.961190288654223e-05, 0.001636080561082828), (9.61824557131022e-05, 0.0018673787388601537), (9.61824557131022e-05, 0.0018673787388601537), (9.61824557131022e-05, 0.0018673787388601537), (9.067957043184055e-05, 0.0017367334828020408), (9.067957043184055e-05, 0.0017367334828020408), (8.961190288654223e-05, 0.001636080561082828), (8.95184933494348e-05, 0.0016281397205323669), (0.00011309139946869622, 0.0019699186117484984), (8.95184933494348e-05, 0.0016281397205323669), (8.95184933494348e-05, 0.0016281397205323669), (9.067957043184055e-05, 0.0017367334828020408), (8.792551651231565e-05, 0.0015631165834399357), (8.961190288654223e-05, 0.001636080561082828), (9.618245571310222e-05, 0.0018673787388601534), (0.0001009666198897732, 0.0017766867163757727), (0.0001009666198897732, 0.0017766867163757727), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.614465508782204e-05, 0.0015551757428894748), (8.35144864048457e-05, 0.0015255998476440221), (8.35144864048457e-05, 0.0015255998476440221), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.35144864048457e-05, 0.0015255998476440221), (8.35144864048457e-05, 0.0015255998476440221), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.35144864048457e-05, 0.0015255998476440221), (8.35144864048457e-05, 0.0015255998476440221), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.210632374234823e-05, 0.001432471327381823), (8.35144864048457e-05, 0.0015255998476440221), (8.35144864048457e-05, 0.0015255998476440221), (8.35144864048457e-05, 0.0015255998476440221), (9.067957043184055e-05, 0.0017367334828020406), (9.067957043184055e-05, 0.0017367334828020406)]

real    6m46.917s
user    0m0.078s
sys     0m0.094s
```

## 未使用のimportを消す

Goだと許されない

```py
import matplotlib.pyplot as plt
```

## 絶対パスのハードコーディング

絶対ないから！
`cd`しよう

```py
df.to_csv("C:\\Users\\rraa9\\Desktop\\研究室\\プログラム\\銘柄選択\\" + line.rstrip() + ".csv")
```

## リストの変数名は複数形や〇〇_listにする

```
name = []
```

## withステートメントの使い方

```py
with open("stock.txt", "r") as stocks:
    name = [i.strip() for i in stocks]
stocks.close() # <-- 必要ない
```

## ループをまとめる

```py
stock_codes = []
with open("stock.txt", "r") as stocks:
    stock_codes = [line.strip() for line in stocks]

stock_dict = {}
for i in stock_codes:
    ...


                    tmp = stock_codes[random.randint(0, len(stock_codes) - 1)]
```

## プログラム全体のパラメータの位置

先頭に置くこと

定数	全大文字 + アンダースコア区切り

```py
#初期個体群
inIndividuals = []

#一世代の個体数
population = 50

#遺伝子座の数
locus = 4

# ... メインのコード
```

## 不要なコピー

```py
individuals = []
individuals = copy.deepcopy(inIndividuals)
```

```py
while True:
    ...

    individuals = copy.deepcopy(nextIndividuals)

    # ループ終了
```

## 複合代入演算子を使用する

```py
ret = ret + (r(i, stock_dict, T) * (1/locus))
```

## リストの代わりに`array`を使用する

https://docs.python.org/3/library/array.html

## 格納される値の意味、型が違うのに同じ名前の変数にしない

```py
def precision(population):
    ...

#一世代の個体数
population = 50
```

## ループの回数が既知の場合はfor文を使う

```py
while True:
    #Terminal condition.
    if maximumTerminal == terminal:
        #世代数が最大世代数なら終了
        break

    ...

    terminal = terminal + 1
```

```py
for terminal in range(maximumTerminal):
    ...
```

## ランダムに二つの組み合わせを取り出す

```py
                I1 = random.randint(0, population - 1)
                I2 = random.randint(0, population - 1)
```

```py
                I1 = random.randint(0, population - 1)
                I2 = random.randint(I1 + 1, I1 + population) % population
```
